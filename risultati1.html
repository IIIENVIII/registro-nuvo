<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Verifiche</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        .red {
            color: red;
        }
        .black {
            color: black;
        }
        .add-button {
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Gestione Verifiche</h1>

    <!-- Selezione classe -->
    <div class="form-group">
        <label for="classe-select">Seleziona classe:</label>
        <select id="classe-select" onchange="cambiaClasse()">
            <option value="" disabled selected>-- Seleziona classe --</option>
            <option value="3media">3 media</option>
            <option value="1superiore">1 superiore</option>
        </select>
    </div>

    <!-- Selezione della materia -->
    <div class="form-group">
        <label for="materia-select">Seleziona materia:</label>
        <select id="materia-select">
            <option value="" disabled selected>-- Seleziona materia --</option>
            <option value="Italiano">Italiano</option>
            <option value="Matematica">Matematica</option>
            <option value="Scienze">Scienze</option>
            <option value="Geografia">Geografia</option>
            <option value="Storia">Storia</option>
            <option value="Ginnastica">Ginnastica</option>
            <option value="Arte">Arte</option>
            <option value="Disegno">Disegno</option>
            <option value="Informatica">Informatica</option>
            <option value="Musica">Musica</option>
        </select>
    </div>

    <!-- Inserimento data -->
    <div class="form-group">
        <label for="data">Data:</label>
        <input type="date" id="data">
    </div>

    <!-- Bottone per creare la tabella delle verifiche -->
    <button class="add-button" onclick="creaVerifica()">Crea Verifica</button>

    <!-- Tabella delle verifiche -->
    <table id="verifiche-table">
        <thead>
            <tr>
                <th>Nome</th>
                <!-- Le colonne per data e materia saranno aggiunte dinamicamente -->
            </tr>
        </thead>
        <tbody id="verifiche-body">
            <!-- Le righe per gli studenti saranno aggiunte dinamicamente -->
        </tbody>
    </table>
</div>

<script>
    const studenti = {
        "3media": [
            "Stellina Dematteis", "Tartaruga Dematteis", "Yucky Benua", "Lollo Benua", "Leonard Benua", 
            "Sparcky Benua", "Flaffy Dematteis", "Tina Dematteis", "Grigetta Benua", "Luna Dematteis",
            "Luna Benua", "Kendy Dematteis", "Papero Benua", "Curt Dematteis", "Briciola Dematteis", "Lampo Benua"
        ],
        "1superiore": [
            "Cane Dematteis", "Cane Benua", "Mician Dematteis", "Cicciobello Allabue", "Micheal Temperini", 
            "Cattivo Temperini", "Bambola Rossetti", "Teschio Carottini", "Robottina Carottini"
        ]
    };

    let verifiche = []; // Memorizza tutte le verifiche con data, materia e voti

    // Funzione per cambiare classe e resettare la tabella
    function cambiaClasse() {
        const classeSelezionata = document.getElementById('classe-select').value;
        document.getElementById('verifiche-body').innerHTML = ''; // Pulisce la tabella
        document.getElementById('verifiche-table').querySelector('thead').innerHTML = `<tr><th>Nome</th></tr>`; // Pulisce le intestazioni
        verifiche = []; // Reset delle verifiche per la nuova classe
        caricaStudenti(classeSelezionata); // Carica i nomi degli studenti
        caricaDati(classeSelezionata); // Carica eventuali dati salvati
    }

    // Funzione per caricare i nomi degli studenti nella tabella
    function caricaStudenti(classe) {
        const tableBody = document.getElementById('verifiche-body');
        studenti[classe].forEach(nome => {
            const row = document.createElement('tr');
            const nameCell = document.createElement('td');
            nameCell.textContent = nome;
            row.appendChild(nameCell);
            tableBody.appendChild(row);
        });
    }

    // Funzione per creare una nuova verifica e aggiungere una colonna alla tabella
    function creaVerifica() {
        const classe = document.getElementById('classe-select').value;
        const materia = document.getElementById('materia-select').value;
        const data = document.getElementById('data').value;

        if (!classe || !materia || !data) {
            alert("Per favore, riempi tutti i campi.");
            return;
        }

        // Aggiunge una nuova verifica alla lista delle verifiche
        verifiche.push({ data, materia, voti: {} });

        // Aggiunge una nuova colonna alla tabella con data e materia
        const tableHead = document.getElementById('verifiche-table').querySelector('thead tr');
        const newHeader = document.createElement('th');
        newHeader.innerHTML = `${data}<br>${materia}`;
        tableHead.appendChild(newHeader);

        // Aggiunge le celle per i voti agli studenti
        const tableBody = document.getElementById('verifiche-body');
        [...tableBody.rows].forEach((row, index) => {
            const votoCell = document.createElement('td');
            votoCell.innerHTML = `<input type="number" min="0" max="100" placeholder="Voto" oninput="salvaVoto(${index}, ${verifiche.length - 1}, this)">`;
            row.appendChild(votoCell);
        });

        // Salva i dati nel localStorage
        salvaDati();
    }

    // Funzione per cambiare il colore del voto in base al valore inserito
    function cambiaColore(input) {
        const voto = parseInt(input.value);
        if (voto >= 0 && voto < 60) {
            input.classList.remove('black');
            input.classList.add('red');
        } else if (voto >= 60 && voto <= 100) {
            input.classList.remove('red');
            input.classList.add('black');
        } else if (input.value.toLowerCase() === "eson" || input.value.toLowerCase() === "ass") {
            input.classList.remove('red');
            input.classList.add('black');
        } else {
            input.classList.remove('red');
            input.classList.remove('black');
        }
    }

    // Funzione per salvare il voto e cambiarne il colore
    function salvaVoto(studenteIndex, verificaIndex, input) {
        const voto = input.value;
        verifiche[verificaIndex].voti[studenteIndex] = voto; // Salva il voto nell'oggetto verifiche
        cambiaColore(input); // Applica il colore giusto al voto
        salvaDati(); // Salva tutto nel localStorage
    }

    // Funzione per salvare i dati nel localStorage
    function salvaDati() {
        const classe = document.getElementById('classe-select').value;
        localStorage.setItem('verifiche_' + classe, JSON.stringify(verifiche)); // Salva con chiave specifica per classe
    }

    // Funzione per caricare i dati dal localStorage
    function caricaDati(classe) {
        const datiSalvati = JSON.parse(localStorage.getItem('verifiche_' + classe)); // Carica con chiave specifica per classe
        if (datiSalvati) {
            verifiche = datiSalvati; // Carica le verifiche salvate
            const tableHead = document.getElementById('verifiche-table').querySelector('thead tr');

            // Aggiunge le colonne per le verifiche giÃ  salvate
            verifiche.forEach((verifica, verificaIndex) => {
                const newHeader = document.createElement('th');
                newHeader.innerHTML = `${verifica.data}<br>${verifica.materia}`;
                tableHead.appendChild(newHeader);

                const tableBody = document.getElementById('verifiche-body');
                [...tableBody.rows].forEach((row, studenteIndex) => {
                    const votoCell = document.createElement('td');
                    const voto = verifica.voti[studenteIndex] || '';
                    votoCell.innerHTML = `<input type="number" min="0" max="100" value="${voto}" placeholder="Voto" oninput="salvaVoto(${studenteIndex}, ${verificaIndex}, this)">`;
                    cambiaColore(votoCell.querySelector('input')); // Cambia il colore del voto
                    row.appendChild(votoCell);
                });
            });
        }
    }

    // Carica la classe iniziale quando la pagina viene caricata
    window.onload = function() {
        const classe = localStorage.getItem('classe');
        if (classe) {
            document.getElementById('classe-select').value = classe;
            caricaStudenti(classe);
            caricaDati(classe);
        }
    };
</script>

</body>
</html>
