<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifiche Classe</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        .red {
            color: red;
        }
        .black {
            color: black;
        }
        .add-button {
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Gestione Verifiche</h1>

    <!-- Selezione classe -->
    <div class="form-group">
        <label for="classe-select">Seleziona classe:</label>
        <select id="classe-select">
            <option value="" disabled selected>-- Seleziona classe --</option>
            <option value="3media">3 media</option>
            <option value="1superiore">1 superiore</option>
        </select>
    </div>

    <!-- Selezione della materia -->
    <div class="form-group">
        <label for="materia-select">Seleziona materia:</label>
        <select id="materia-select">
            <option value="" disabled selected>-- Seleziona materia --</option>
            <option value="Italiano">Italiano</option>
            <option value="Matematica">Matematica</option>
            <option value="Scienze">Scienze</option>
            <option value="Geografia">Geografia</option>
            <option value="Storia">Storia</option>
            <option value="Ginnastica">Ginnastica</option>
            <option value="Arte">Arte</option>
            <option value="Disegno">Disegno</option>
            <option value="Informatica">Informatica</option>
            <option value="Musica">Musica</option>
        </select>
    </div>

    <!-- Inserimento data -->
    <div class="form-group">
        <label for="data">Data:</label>
        <input type="date" id="data">
    </div>

    <!-- Bottone per creare la tabella delle verifiche -->
    <button class="add-button" onclick="creaTabella()">Crea Verifica</button>

    <!-- Link alla pagina dei risultati -->
    <div style="text-align: center; margin-top: 20px;">
        <a href="risultati1.html">Visualizza risultati</a>
    </div>

    <!-- Tabella delle verifiche -->
    <table id="verifiche-table">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Media</th>
                <th>Verifica</th>
                <th>Materia</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody id="verifiche-body">
        </tbody>
    </table>
</div>

<script>
    const studenti = {
        "3media": [
            "Stellina Dematteis", "Tartaruga Dematteis", "Yucky Benua", "Lollo Benua", "Leonard Benua", 
            "Sparcky Benua", "Flaffy Dematteis", "Tina Dematteis", "Grigetta Benua", "Luna Dematteis",
            "Luna Benua", "Kendy Dematteis", "Papero Benua", "Curt Dematteis", "Briciola Dematteis", "Lampo Benua"
        ],
        "1superiore": [
            "Cane Dematteis", "Cane Benua", "Mician Dematteis", "Cicciobello Allabue", "Micheal Temperini", 
            "Cattivo Temperini", "Bambola Rossetti", "Teschio Carottini", "Robottina Carottini"
        ]
    };

    window.onload = function() {
        caricaDati();
    };

    function creaTabella() {
        const classe = document.getElementById('classe-select').value;
        const materia = document.getElementById('materia-select').value;
        const data = document.getElementById('data').value;

        if (!classe || !materia || !data) {
            alert("Per favore, riempi tutti i campi.");
            return;
        }

        const tableBody = document.getElementById('verifiche-body');
        tableBody.innerHTML = ''; // Resetta la tabella

        studenti[classe].forEach(nome => {
            const row = document.createElement('tr');

            // Colonna nome
            const nameCell = document.createElement('td');
            nameCell.textContent = nome;
            row.appendChild(nameCell);

            // Colonna media (inizialmente vuota)
            const mediaCell = document.createElement('td');
            mediaCell.textContent = '-';
            row.appendChild(mediaCell);

            // Colonna verifica
            const verificaCell = document.createElement('td');
            const inputVoto = document.createElement('input');
            inputVoto.type = 'number';
            inputVoto.min = 10;
            inputVoto.max = 100;
            inputVoto.placeholder = "Inserisci voto";

            inputVoto.addEventListener('input', function() {
                const voto = parseInt(this.value);

                if (voto < 60) {
                    this.classList.add('red');
                    this.classList.remove('black');
                } else {
                    this.classList.add('black');
                    this.classList.remove('red');
                }

                aggiornaMedia(nome, tableBody);
            });

            verificaCell.appendChild(inputVoto);
            row.appendChild(verificaCell);

            // Colonna materia
            const materiaCell = document.createElement('td');
            materiaCell.textContent = materia;
            row.appendChild(materiaCell);

            // Colonna data
            const dataCell = document.createElement('td');
            dataCell.textContent = data;
            row.appendChild(dataCell);

            tableBody.appendChild(row);
        });

        // Salva i dati nel localStorage
        salvaDati();
    }

    function aggiornaMedia(nome, tableBody) {
        const voti = [];

        [...tableBody.rows].forEach(row => {
            const nomeStudente = row.cells[0].textContent;
            if (nomeStudente === nome) {
                const voto = row.cells[2].children[0].value;
                if (voto) {
                    voti.push(parseInt(voto));
                }
            }
        });

        const media = voti.length ? (voti.reduce((a, b) => a + b, 0) / voti.length).toFixed(2) : '-';
        
        [...tableBody.rows].forEach(row => {
            const nomeStudente = row.cells[0].textContent;
            if (nomeStudente === nome) {
                row.cells[1].textContent = media;
            }
        });

        // Salva i dati aggiornati nel localStorage
        salvaDati();
    }

    // Funzione per salvare i dati nel localStorage
    function salvaDati() {
        const classe = document.getElementById('classe-select').value;
        const materia = document.getElementById('materia-select').value;
        const data = document.getElementById('data').value;

        if (!classe || !materia || !data) return;

        const verifiche = [];

        [...document.getElementById('verifiche-body').rows].forEach(row => {
            const nome = row.cells[0].textContent;
            const media = row.cells[1].textContent;
            const voto = row.cells[2].children[0].value;
            verifiche.push({ nome, media, voto, materia, data });
        });

        localStorage.setItem('classe', classe);
        localStorage.setItem('materia', materia);
        localStorage.setItem('data', data);
        localStorage.setItem('verifiche', JSON.stringify(verifiche));
    }

    // Funzione per caricare i dati dal localStorage
    function caricaDati() {
        const classe = localStorage.getItem('classe');
        const materia = localStorage.getItem('materia');
        const data = localStorage.getItem('data');
        const verifiche = JSON.parse(localStorage.getItem('verifiche')) || [];

        if (classe) {
            document.getElementById('classe-select').value = classe;
        }
        if (materia) {
            document.getElementById('materia-select').value = materia;
        }
        if (data) {
            document.getElementById('data').value = data;
        }

        const tableBody = document.getElementById('verifiche-body');
        tableBody.innerHTML = ''; // Resetta la tabella

        verifiche.forEach(verifica => {
            const row = document.createElement('tr');

            // Colonna nome
            const nameCell = document.createElement('td');
            nameCell.textContent = verifica.nome;
            row.appendChild(nameCell);

            // Colonna media
            const mediaCell = document.createElement('td');
            mediaCell.textContent = verifica.media;
            row.appendChild(mediaCell);

            // Colonna verifica
            const verificaCell = document.createElement('td');
            const inputVoto = document.createElement('input');
            inputVoto.type = 'number';
            inputVoto.min = 10;
            inputVoto.max = 100;
            inputVoto.placeholder = "Inserisci voto";
            inputVoto.value = verifica.voto;

            inputVoto.addEventListener('input', function() {
                const voto = parseInt(this.value);

                if (voto < 60) {
                    this.classList.add('red');
                    this.classList.remove('black');
                } else {
                    this.classList.add('black');
                    this.classList.remove('red');
                }

                aggiornaMedia(verifica.nome, tableBody);
            });

            verificaCell.appendChild(inputVoto);
            row.appendChild(verificaCell);

            // Colonna materia
            const materiaCell = document.createElement('td');
            materiaCell.textContent = verifica.materia;
            row.appendChild(materiaCell);

            // Colonna data
            const dataCell = document.createElement('td');
            dataCell.textContent = verifica.data;
            row.appendChild(dataCell);

            tableBody.appendChild(row);
        });
    }
</script>

</body>
</html>
